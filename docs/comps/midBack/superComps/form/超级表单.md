# 超级表单
## 实战项目完整案例


```html
<template type="text/html">
  <div class="hlta_superForm">
    <ta-drawer
      width="100%"
      placement="right"
      :closable="false"
      :visible="visible"
      v-if="visible"
    >
      <hlta-superTitle
        slot="title"
        :font="'h4'"
        :back="true"
        :title="title"
        @click="onClose"
      ></hlta-superTitle>
      <fh-face-plate
        :shadow="true"
        :innerPad="10"
        :outerMarg="20"
        :allStyle="{ paddingTop: '25px', marginTop: '10px' }"
      >
        <ta-tabs
          :defaultActiveKey="defaultActiveKey"
          ref="taTabsDom"
          @change="changeTab"
          :style="{ background: '#fff' }"
          @tabClick="fntabClick"
        >
          <ta-tab-pane tab="基本信息" key="1"></ta-tab-pane>
        </ta-tabs>
        <div v-show="defaultActiveKey == '1'">
          <tForm
            ref="t-form01"
            :form-info="tFormInfo"
            :edit-items="createItems"
            :item="item"
          >
            <hlta-superTitle
              slot="title"
              :theme="1"
              :font="'h5'"
              :title="'基本信息'"
            ></hlta-superTitle>
          </tForm>
          <tForm
            ref="t-form02"
            :form-info="tFormInfo2"
            :edit-items="createItems2"
            :item="item2"
          >
            <hlta-superTitle
              slot="title"
              :theme="1"
              :font="'h5'"
              :title="'项目说明'"
            >
            </hlta-superTitle>
            <template slot="addEdits">
              <ta-col :span="8">
                <div class="icontip icontip2">
                  <ta-tooltip placement="topLeft">
                    <template slot="title">
                      支持jpg/jpeg/png/word/pdf 格式，单个不超过10M
                    </template>
                    <ta-icon type="question-circle" class="icon-style"/>
                  </ta-tooltip>
                </div>
                <ta-form-item
                  label="附件"
                  :span="12"
                  fieldDecoratorId="ossIdList"
                >
                  <ta-upload
                    :fileList="fileList"
                    :customRequest="handleChange"
                    :remove="handleRemove"
                    :action="url"
                    name="file"
                    :beforeUpload="beforeUpload"
                    accept=".jpg,.jpeg,.png,.doc,.docx,.pdf"
                  >
                    <ta-button>
                      <ta-icon type="upload"/>
                      上传
                    </ta-button>
                  </ta-upload>
                </ta-form-item>
              </ta-col>
            </template>
            <template slot="addEdits">
              <ta-col :span="8">
                <div class="icontip icontip3">
                  <ta-tooltip placement="topLeft">
                    <template slot="title">
                      多个附件，支持扩展名：.rar .zip .doc .docx .pdf .jpg .png ，单个附件不超过10M
                    </template>
                    <ta-icon type="question-circle" class="icon-style"/>
                  </ta-tooltip>
                </div>
                <ta-form-item
                  label="项目评估报告"
                  :span="12"
                  fieldDecoratorId="assReportList"
                >
                  <ta-upload
                    name="file"
                    :fileList="fileList2"
                    :action="url"
                    :remove="handleRemove2"
                    :customRequest="handleChange2"
                    :beforeUpload="beforeUploadReport"
                  >
                    <ta-button>
                      <ta-icon type="upload"/>
                      上传
                    </ta-button>
                  </ta-upload>
<!--                  <div style="color: #aaa; display: block">-->
<!--                    (多个附件，支持扩展名：.rar .zip .doc .docx .pdf .jpg .png-->
<!--                    ，单个附件不超过10M)-->
<!--                  </div>-->
                </ta-form-item>
              </ta-col>
            </template>
          </tForm>
          <div>
            <tForm
              v-for="(table, tbIdx) in tform_group"
              :key="tbIdx"
              :ref="`t-form${tbIdx}`"
              :form-info="tFormInfo3"
              :edit-items="table.createItems"
              :item="table.item"
            >
              <hlta-superTitle
                slot="title"
                v-if="tbIdx === 0"
                :theme="1"
                :font="'h5'"
                :title="'项目执行方'"
                :more-btn="projectQuality != '01'"
                :addNewForm="true"
                :addFormOb="addFormObj"
                :roller="true"
              >
                <template slot="moreBtn"></template>
              </hlta-superTitle>
              <ta-divider
                v-else
                slot="title"
                :dashed="true"
                :orientation="'center'"
              >
                第{{ tbIdx + 1 }}部分
              </ta-divider>
            </tForm>
          </div>
        </div>
      </fh-face-plate>

      <div slot="footer">
        <ta-button :style="{ marginRight: 8 }" @click="onClose">
          返回
        </ta-button>
        <ta-button @click="save" type="primary">保存</ta-button>
      </div>
    </ta-drawer>
  </div>
</template>

```


```js
<script>
import introPanel from '@bizCp/hlta-superForm/src/modules/intro-panel'
import tForm from '@bizCp/hlta-superForm/src/modules/together-form'

import {
  hlta_SetCompsRadioGroup_muliPropertys,
  hlta_SetCompsSelectTreeData,
  hlta_SetComps_general_initOptdata,
  hlta_SetCompsCheckGroup_checkAll,
  hlta_BackDictValueArr,
  RecombineCollectionToTree,
  hlta_SetCustomComps_general_initOptdata,
  DisableTreeDataOtherBranch,
  ReEnableTreeDataAllBranch,
  hlta_SetCompsCheckGroup_onValues,
} from '@bizCp/hlta-Utils'
import feedBack from '@/scopes/project/projectProcess/modulePart/feedBack/feedBackRead.vue'
import implementPlan from '@/scopes/project/projectProcess/modulePart/implementPlan/implementPlanRead.vue'
import Vue from 'vue'
import _ from 'lodash'
import item from '@/scopes/core/workTable/workTablePage/modulePart/page/part/item'
import taDrawerCtrl from '@bizCp/hlta-Utils/lib/mineStoreExt/modules/taFrame.js'
import activeJoin from '@/scopes/project/projectProcess/modulePart/activeJoin/activeJoin'

export default {
  name: 'philanthropicVentureInfo',
  components: {
    introPanel,
    tForm,
    feedBack,
    implementPlan,
    activeJoin,
  },
  props: {
    title: String,
    projectQuality: String,
    businessDepList: Array,
  },
  mixins: [taDrawerCtrl],
  data () {
    return {
      previewVisible: false,
      previewImage: '',
      url: faceConfig.basePath + '/oss/upload',
      areaList: [
        {
          spell: '0',
          namePath: '浙江省/温州市',
          childNum: 12,
          destory: '0',
          parentId: '330000000000',
          effective: '1',
          areaCode: '330300000000',
          areaId: '330300000000',
          idPath: '330000000000/330300000000',
          modifyTime: '2022-09-14 14:07:38',
          areaName: '温州市',
          createTime: '2022-09-14 14:07:38',
          children: [],
          areaLevel: 1,
          createUser: 'zjcsmsb',
          areaOrder: 2,
        },
      ], //行政区划合集
      visible: false,
      prevViewItem: null, //前一视图带来的参数合集
      hasUpdate: false,
      annualInspectionRadio: false,
      qualificationsRadio: false,
      socialOrgRadio: false,
      svoluntaryOrgRadio: false,
      taxExemptionRadio: true,
      defaultActiveKey: '1',
      addFormObj: {
        count: 5,
        name: 'philanthropicVentureInfo',
        btns: [
          {
            type: 'plus',
            onOk: (it) => {
              console.log('plus===', it)
            },
          },
          {
            type: 'minus',
            onOk: (it) => {
              console.log('minus===', it)
            },
          },
        ],
      },
      createItems: [
        {
          type: 'text',
          property: 'projectName',
          label: '项目名称',
          require: true,
          maxLength: 50,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 50,
                message: '字段最大长度为50',
              },
            ],
          },
          // disabled: true,
        },
        {
          type: 'date',
          property: 'projectStartTime',
          label: '项目开始时间',
          require: true,
          // disabled: true,
        },
        {
          type: 'date',
          property: 'projectEndTime',
          label: '项目结束时间',
          require: true,
          // disabled: true,
        },
        {
          type: 'multiSingleSelected',
          label: '实施区域',
          property: 'admsAreaList',
          treeId: 'result',
          replaceFields: {
            title: 'areaName',
            key: 'areaCode',
            value: 'areaCode',
          },
          treeDataLabel: 'areaName',
          treeDataValue: 'areaCode',
          treeNodeId: 'areaCode',
          url: 'area/select',
          multiple: true,
          require: true,
          hidden: false,
          treeDataAsync: [],
          treeDefaultExpandedKeys: [],
          span: 24,
          value: [],
        },
        {
          type: 'select',
          property: 'demandType',
          label: '服务领域',
          collectionType: 'REQUIRETYPE',
          require: true,
          mode: 'default',
          // disabled: true,
        },
        {
          type: 'select',
          property: 'projectStatus',
          label: '项目状态',
          collectionType: 'PROJECTSTATUS',
          colSpan: 8,
          require: true,
          mode: 'default',
          // disabled: true,
        },
        {
          type: 'textarea',
          property: 'projectBackground',
          // label: '项目背景',
          slotMode: true,
          allRound: true, //全手动配置模式-用于定制个性化样式
          slot_label: {
            name: '项目背景',
            html: `<div style="text-align:left;display:inline-block">项目背景：</div>`,
            labelSpan: 2,
            inputSpan: 22,
            colStyle: {
              // width: "6.33333%", //终极解决大法
              width: 'initial', //终极解决大法
            },
          },
          maxLength: 300,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 300,
                message: '字段最大长度为300',
              }
            ],
          },
          // labelWidth: '65px',
          span: 24,
          tooltip: {
            colStyle: {
              // width:"3.355555%",
              // width: "initial", //终极解决大法
              // margin: "0.5% 0.996% 0.1%",
            },
            show: true,
            content: `项目设计缘由，清楚阐述项目需要解决什么社会问题、落地社区背景、已经开展过的调研结果、服务对象选定依据，不超过300字`,
          },
        },
        {
          type: 'textarea',
          property: 'projectedOutputs',
          // label: '预计产出',
          slotMode: true,
          allRound: true, //全手动配置模式-用于定制个性化样式
          slot_label: {
            html: `<div style="text-align:left;display:inline-block">预计产出：</div>`,
            labelSpan: 2,
            inputSpan: 22,
            colStyle: {
              // width: "6.33333%", //终极解决大法
              width: 'initial', //终极解决大法
            },
          },
          maxLength: 300,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 300,
                message: '字段最大长度为300',
              },
            ],
          },
          span: 24,
          tooltip: {
            colStyle: {
              // width:"3.355555%",
              // width: "initial", //终极解决大法
              // margin: "0.5% 0.996% 0.1%",
            },
            show: true,
            content: `预期取得的成果和产出（需具体），并列明成果的具体表现和需达到的水平以及指标，300字以内`,
          },
        },
        {
          type: 'checkGroup',
          property: 'cpServeObjectPoList',
          label: '服务对象',
          collectionType: 'SERVICEOBJECT',
          require: true,
          checkBoxAll: true,
          span: 24,
          checkAll: false,
          onValues: [],
          indeterminate: false,
          cb_AllChange: async (it) => {
            console.log('cb_AllChange', it)
            let {
              $event: e,
              editItem
            } = it
            console.log('e', e, 'editItem', editItem)
            const curDictArr = await Base.asyncGetCodeData('SERVICEOBJECT')
            console.log('字典lll', curDictArr)
            let isChecked = e.target.checked
            if (isChecked) {
              //全选
              hlta_SetCompsCheckGroup_checkAll.call(
                this,
                this.createItems,
                'cpServeObjectPoList',
                true
              )
              const dictCodeArr = hlta_BackDictValueArr({
                dict: 'SERVICEOBJECT',
                arr: curDictArr,
              })
              it.editItem.indeterminate = false
              this.item.cpServeObjectPoList = dictCodeArr
            } else {
              //反选
              hlta_SetCompsCheckGroup_checkAll.call(
                this,
                this.createItems,
                'cpServeObjectPoList',
                false
              )
              it.editItem.indeterminate = false
              this.item.cpServeObjectPoList = []
            }
            console.log('全选=', this.item)
          },
          cb_change: async (it) => {
            console.log('cb_Change=', it)
            let {
              $event: e,
              editItem
            } = it
            const curDictArr = await Base.asyncGetCodeData('SERVICEOBJECT')
            console.log('字典lll', curDictArr)
            if (e.length < curDictArr.length) {
              hlta_SetCompsCheckGroup_checkAll.call(
                this,
                this.createItems,
                'cpServeObjectPoList',
                false
              )
              it.editItem.indeterminate = true
            }
            console.log('单选=', this.item)
          },
          // type: "select",
          // property: "cpServeObjectPoList",
          // label: "服务对象",
          // collectionType: "SERVICEOBJECT",
          // require: true,
          // mode: "multiple",
          // span: 24,
          disabled: true,
        },
        {
          type: 'number',
          property: 'serveNum',
          label: '服务人数',
          require: false,
          precision: 0,
          // disabled: true,
        },
        {
          type: 'number',
          property: 'budget',
          label: '经费预算(万元)',
          require: true,
          precision: 2,
          wrapperColSpan: 22,
          tooltip: {
            wrapperColSpan: 2,
            show: true,
            content: `项目整体预算（完成项目所需资金总额）、申请创投资金、自筹资金、其他`,
          },
          // disabled: true,
        },
      ],
      createItems2: [
        {
          type: 'select',
          property: 'projectQuality',
          label: '项目性质',
          initValue: this.projectQuality,
          collectionType: 'PROJECTNATURE',
          // colSpan: 6,
          // wrapperCol: {span: 2},
          labelWidth: '121px',
          require: true,
          mode: 'default',
          cb_select: (e) => {
            // hlta_SetCompsRadioGroup_boolean.call(
            //   this,
            //   this.createItems2,
            //   ['funder'],
            //   e.$event != '01' ? true : false,
            // )
            // hlta_SetCompsRadioGroup_boolean.call(
            //   this,
            //   this.createItems2,
            //   ['publicFundraising'],
            //   e.$event != '03' ? true : false
            // )
            hlta_SetCompsRadioGroup_muliPropertys.call(
              this,
              this.createItems2,
              ['funder'],
              {
                hidden: () => {
                  let bn = e.$event == '01' ? true : false
                  if (!bn) {
                    let formData =
                      this.$refs['t-form02'].form999.getFieldsValue()
                    Object.assign(formData, { funder: null })
                    this.$refs['t-form02'].form999.setFieldsValue(formData)
                  }
                  return bn
                },
              }
            )
            hlta_SetCompsRadioGroup_muliPropertys.call(
              this,
              this.createItems2,
              ['publicFundraising'],
              {
                hidden: () => {
                  let bn = e.$event == '03' ? true : false
                  if (!bn) {
                    let formData =
                      this.$refs['t-form02'].form999.getFieldsValue()
                    Object.assign(
                      formData,
                      { publicFundraising: '0' },
                      { recordCode: null },
                      { recordName: null }
                    )
                    this.$refs['t-form02'].form999.setFieldsValue(formData)
                  }
                  return bn
                },
              }
            )
          },
        },
        {
          type: 'select',
          property: 'funder',
          label: '资助方',
          options: this.businessDepList,
          labelWidth: '121px',
          mode: 'default',
          require: true,
          hidden: true,
        },
        {
          type: 'select',
          property: 'fundSource',
          label: '资金来源',
          collectionType: 'SOURCEFUNDS',
          labelWidth: '121px',
          // colSpan: 6,
          require: true,
          mode: 'default',
          // disabled: true,
        },
        {
          type: 'radioGroup',
          property: 'publicFundraising',
          label: '是否公开募捐',
          labelWidth: '121px',
          options: [
            {
              label: '否',
              value: '0',
            },
            {
              label: '是',
              value: '1',
            },
          ],
          colSpan: 6,
          require: true,
          initValue: '0',
          hidden: true,
          cb_change: (e) => {
            // hlta_SetCompsRadioGroup_boolean.call(
            //   this,
            //   this.createItems2,
            //   ["recordCode"],
            //   e.$event.target.value == "0" ? true : false
            // );
            // hlta_SetCompsRadioGroup_boolean.call(
            //   this,
            //   this.createItems2,
            //   ["recordName"],
            //   e.$event.target.value == "0" ? true : false
            // );
            hlta_SetCompsRadioGroup_muliPropertys.call(
              this,
              this.createItems2,
              ['recordCode', 'recordName'],
              {
                hidden: () => {
                  let bn = e.$event.target.value != '0' ? true : false
                  if (!bn) {
                    let formData =
                      this.$refs['t-form02'].form999.getFieldsValue()
                    Object.assign(
                      formData,
                      { recordCode: null },
                      { recordName: null }
                    )
                    this.$refs['t-form02'].form999.setFieldsValue(formData)
                  }
                  return bn
                },
              }
            )
          },
        },
        {
          type: 'text',
          property: 'recordCode',
          label: '公募备案编号',
          labelWidth: '121px',
          maxLength: 50,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 50,
                message: '字段最大长度为50',
              },
              {
                pattern: /^[A-Za-z0-9]+$/,
                message: '只支持数字和字母',
              },
            ],
          },
          hidden: true,
        },
        {
          type: 'text',
          property: 'recordName',
          label: '募捐备案名称',
          labelWidth: '121px',
          colSpan: 6,
          maxLength: 50,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 50,
                message: '字段最大长度为50',
              },
            ],
          },
          hidden: true,
        },
        {
          type: 'multiSingleSelected',
          property: 'cpTypePoList',
          label: '项目分类',
          treeId: 'result',
          labelWidth: '121px',
          replaceFields: {
            title: 'label',
            key: 'value',
            value: 'value',
          },
          multiple: true,
          treeDataLabel: 'label',
          treeDataValue: 'value',
          span: 18,
          treeDataAsync: [],
          treeDefaultExpandedKeys: [],
          cb_change: (val) => {
            this.cpTypeChange(val)
          },
        },
        {
          type: 'textarea',
          property: 'projectInnovation',
          // label: "项目创新性",
          slotMode: true,
          allRound: true, //全手动配置模式-用于定制个性化样式
          slot_label: {
            html: `<div style="text-align:left;display:inline-block">项目创新性：</div>`,
            labelSpan: 2,
            inputSpan: 22,
            colStyle: {
              // width: "6.33333%", //终极解决大法
              width: 'initial', //终极解决大法
            },
          },
          maxLength: 300,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 300,
                message: '字段最大长度为300',
              },
            ],
          },
          // wrapperCol: {
          //   span: 16,
          // },
          // labelCol: {
          //   span: 8,
          // },
          // labelWidth: "85px",
          span: 24,
          tooltip: {
            colStyle: {
              // width:"3.355555%",
              // width: "initial", //终极解决大法
              // margin: "0.5% 0.996% 0.1%",
            },
            show: true,
            content: `（分析本项目与同类项目的差异性及本项目的独特性，以及完成本项目规定的目标和产出之外的亮点或成效）`,
          },
        },
        {
          type: 'textarea',
          property: 'riskMeasure',
          isLongLabel: true, //插槽模式开启
          // label: "可预见风险及应对措施",
          slotMode: true,
          allRound: true, //全手动配置模式-用于定制个性化样式
          slot_label: {
            html: `<div style="text-align:left;display:inline-block">可预见风险<br/>及应对措施：</div>`,
            labelSpan: 2,
            inputSpan: 22,
            colStyle: {
              // width: "6.33333%", //终极解决大法
              width: 'initial', //终极解决大法
            },
          },
          // labelCol: {
          //   span: 20,
          // },
          // wrapperCol: {
          //   span: 16,
          // },
          maxLength: 300,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 300,
                message: '字段最大长度为300',
              },
            ],
          },
          // labelWidth: "88px",
          span: 24,
          tooltip: {
            colStyle: {
              // width:"3.355555%",
              // width: "initial", //终极解决大法
              // margin: "0.5% 0.996% 0.1%",
            },
            show: true,
            content: `可预见风险及应对措施：(说明实施过程中，在技术、人力、经济或政策等方面，有可能遇到哪些困难和风险，如何避免或克服这些困难或风险。)`,
          },
        },
      ],
      createItems3: [
        {
          type: 'select',
          property: 'bsoId',
          options: [],
          label: '执行机构',
          require: true,
          mode: 'default',
          span: 24,
          showSearch: true,
        },
        {
          type: 'textarea',
          property: 'synopsis',
          label: '机构简介',
          maxLength: 1000,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 1000,
                message: '字段最大长度为1000',
              },
            ],
          },
          span: 24,
        },
        {
          type: 'text',
          property: 'personName',
          label: '项目联系人',
          require: true,
          maxLength: 100,
          fieldDecoratorOptions: {
            rules: [
              {
                max: 100,
                message: '字段最大长度为100',
              },
            ],
          },
          span: 11,
        },
        {
          type: 'text',
          property: 'personPhone',
          label: '联系人手机',
          fieldDecoratorOptions: {
            rules: [
              {
                required: true,
                pattern:
                  /(^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$)|(^((\(\d{3}\))|(\d{3}\-))?(1[3578]\d{9})$)|(^(400)-(\d{3})-(\d{4})(.)(\d{1,4})$)|(^(400)-(\d{3})-(\d{4}$))/,
                message: '请输入正确的联系电话',
              },
            ],
          },
          span: 12,
        },
      ],
      tform_group: [
        {
          item: {}, //用于存放-tForm-字段值
          createItems: [
            {
              type: 'select',
              property: 'bsoId',
              options: [],
              label: '执行机构',
              require: true,
              mode: 'default',
              span: 24,
            },
            {
              type: 'textarea',
              property: 'synopsis',
              label: '机构简介',
              maxLength: 1000,
              fieldDecoratorOptions: {
                rules: [
                  {
                    max: 1000,
                    message: '字段最大长度为1000',
                  },
                ],
              },
              span: 24,
            },
            {
              type: 'text',
              property: 'personName',
              label: '项目联系人',
              require: true,
              maxLength: 100,
              fieldDecoratorOptions: {
                rules: [
                  {
                    max: 100,
                    message: '字段最大长度为100',
                  },
                ],
              },
              span: 11,
            },
            {
              type: 'text',
              property: 'personPhone',
              label: '联系人手机',
              fieldDecoratorOptions: {
                rules: [
                  {
                    required: true,
                    pattern:
                      /(^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$)|(^((\(\d{3}\))|(\d{3}\-))?(1[3578]\d{9})$)|(^(400)-(\d{3})-(\d{4})(.)(\d{1,4})$)|(^(400)-(\d{3})-(\d{4}$))/,
                    message: '请输入正确的联系电话',
                  },
                ],
              },
              span: 12,
            },
          ],
        },
      ],
      item: {
        cpServeObjectPoList: [],
        assReportList: [],
        admsAreaList: [],
        cpTypePoList: [],
        ossIdList: [],
      }, //用于存放-tForm-字段值
      item2: {}, //用于存放-tForm-字段值
      item3: {}, //用于存放-tForm-字段值
      detailInfo: null, //基本信息- 表单承载器
      tFormInfo: {
        labelWidth: '110px',
      },
      tFormInfo2: {
        labelWidth: '150px',
      },
      tFormInfo3: {
        labelWidth: '120px',
      },
      fileList: [],
      fileList2: [],
      institutionList: [],
      cpTypeTreeData: [],
    }
  },
  created () {
    // this.getDictData();
    console.log('项目编辑界面重新加载')
  },
  beforeDestroy () {
    this.defaultActiveKey = '1'
    console.log('beforeDestroy==')
  },
  methods: {
    async cpTypeChange (val) {
      // 获取treeData
      let treeData = val.editItem.treeDataAsync
      // treeData禁用其他分支
      await this.handleBranch(val.$event, treeData)
    },

    async handleBranch (vals, treeData, needRecheck = false) {
      // treeData禁用其他分支
      if (!vals || vals.length === 0) {
        // 重新启用全部分支
        let result = await ReEnableTreeDataAllBranch.call(this, treeData)
        // treeData替换
        await hlta_SetCustomComps_general_initOptdata.call(
          this,
          this.createItems2,
          'cpTypePoList',
          result,
          'treeDataAsync'
        )
      }
      if (vals.length === 1 || needRecheck) {
        let result = await DisableTreeDataOtherBranch.call(
          this,
          treeData,
          vals[0]
        )
        // treeData替换
        await hlta_SetCustomComps_general_initOptdata.call(
          this,
          this.createItems2,
          'cpTypePoList',
          result,
          'treeDataAsync'
        )
      }
    },

    getDictData () {
      let collectionData = this.CollectionData('CLASSIFICATION')
      let arr = _.cloneDeep(collectionData)
      this.cpTypeTreeData = RecombineCollectionToTree.call(this, arr)
      hlta_SetCustomComps_general_initOptdata.call(
        this,
        this.createItems2,
        'cpTypePoList',
        this.cpTypeTreeData,
        'treeDataAsync'
      )
      // await this.getBusinessDepList()
    },
    // getBusinessDepList () {
    //   this.Base.submit(null, {
    //     method: 'post',
    //     url: 'taOrg/inputSelectMzDpmt',
    //   }).then((data) => {
    //     let businessDepList = []
    //     data.data.result.forEach(it => {
    //       let item = {}
    //       item.label = it.orgName
    //       item.value = it.orgId
    //       businessDepList.push(item)
    //     })
    //     hlta_SetComps_general_initOptdata.call(this, this.createItems2,
    //       'funder', businessDepList
    //     )
    //   })
    // },
    getInstitution () {
      return this.Base.submit(
        null,
        {
          url: 'socialOrg/listSocialOrg',
          method: 'post',
          // autoValid: true, // 提交前自动验证
          autoQs: false,
        },
        {
          successCallback: (data) => {
            data.data.result.forEach((it) => {
              let item = {}
              item.label = it.socialOrgName
              item.value = it.id
              this.institutionList.push(item)
            })
            // hlta_SetComps_general_initOptdata.call(
            //   this,
            //   this.createItems3,
            //   'bsoId',
            //   this.institutionList
            // )
            this.tform_group = []
            for (let i = 0; i < this.addFormObj.count; i++) {
              this.tform_group.push({
                item: [],
                createItems: this.createItems3,
              })
              hlta_SetComps_general_initOptdata.call(
                this,
                this.createItems3,
                'bsoId',
                this.institutionList
              )
              return
            }
          },
        } // failCallback: (data) => {},
      )
    },
    handleCancel () {
      this.previewVisible = false
    },
    handlePreview (file) {
      this.previewImage = file.url || file.thumbUrl
      this.previewVisible = true
    },
    // 上传文件
    // 手动上传,上传之前的回调需要返回false
    handleRemove (file) {
      const index = this.fileList.indexOf(file)
      const newFileList = this.fileList.slice()
      newFileList.splice(index, 1)
      this.fileList = newFileList
    },
    beforeUpload (file) {
      if (this.fileList.length >= 10) {
        this.$message.error('文件上传数量不能超过10个')
        return false
      }
      const suffix = file.name.substr(file.name.length - 4).toLowerCase()
      console.log("suffix===",suffix)
      let fileName = false
      // jpg/png/word/pdf
      if (
        suffix.indexOf('JPG') != -1 ||
        suffix.indexOf('PNG') != -1 ||
        suffix.indexOf('jpg') != -1 ||
        suffix.indexOf('png') != -1 ||
        suffix.indexOf('docx') != -1 ||
        suffix.indexOf('doc') != -1 ||
        suffix.indexOf('pdf') != -1 ||
        suffix.indexOf('jpeg') != -1
      ) {
        fileName = true
      } else {
        this.$message.error('文件类型不正确，请上传规定类型的文件')
        fileName = false
      }
      const isLt2M = file.size / 1024 / 1024 < 10
      if (!isLt2M) {
        this.$message.error('大小10M以内')
      }
      return isLt2M && fileName
    },
    handleChange (info) {
      let ae = this.beforeUpload(info.file)
      if (ae) {
        this.Base.submit(
          null,
          {
            url: '/oss/upload',
            data: {
              file: info.file, // 文件参数,可以是文件数组
            },
            isFormData: true,
          },
          {
            successCallback: (res) => {
              if (res.data.result.status === 'done') {
                let newFileList = res.data.result
                let param = {}
                param.name = newFileList.originalName
                param.uid = newFileList.ossId
                param.url = newFileList.path
                param.status = newFileList.status
                param.contentType = newFileList.contentType
                this.fileList.push(param)
                this.$message.success('上传成功')
              } else {
                this.$message.error('上传失败')
              }
            },
            failCallback: (data) => {
              this.$message.error('上传失败')
            },
          }
        )
      }
    },
    handleRemove2 (file) {
      const index = this.fileList2.indexOf(file)
      const newFileList = this.fileList2.slice()
      newFileList.splice(index, 1)
      this.fileList2 = newFileList
    },
    beforeUploadReport (file) {
      if (this.fileList2.length >= 10) {
        this.$message.error('文件上传数量不能超过10个')
        return false
      }
      const suffix = file.name.substr(file.name.length - 4)
      let fileName = false
      // .rar .zip .doc .docx .pdf .jpg .png
      if (
        suffix.indexOf('rar') != -1 ||
        suffix.indexOf('zip') != -1 ||
        suffix.indexOf('docx') != -1 ||
        suffix.indexOf('doc') != -1 ||
        suffix.indexOf('pdf') != -1 ||
        suffix.indexOf('jpg') != -1 ||
        suffix.indexOf('png') != -1 ||
        suffix.indexOf('JPG') != -1 ||
        suffix.indexOf('PNG') != -1
      ) {
        fileName = true
      } else {
        this.$message.error('文件类型不正确，请上传规定类型的文件')
        fileName = false
      }
      const isLt2M = file.size / 1024 / 1024 < 10
      if (!isLt2M) {
        this.$message.error('大小10M以内')
      }
      return isLt2M && fileName
    },
    handleChange2 (info) {
      let ae = this.beforeUploadReport(info.file)
      if (ae) {
        this.Base.submit(
          null,
          {
            url: '/oss/upload',
            data: {
              file: info.file, // 文件参数,可以是文件数组
            },
            isFormData: true,
          },
          {
            successCallback: (res) => {
              if (res.data.result.status === 'done') {
                let newFileList = res.data.result
                let param = {}
                param.name = newFileList.originalName
                param.uid = newFileList.ossId
                param.url = newFileList.path
                param.status = newFileList.status
                param.contentType = newFileList.contentType
                this.fileList2.push(param)
                this.$message.success('上传成功')
              } else {
                this.$message.error('上传失败')
              }
            },
            failCallback: (data) => {
              this.$message.error('上传失败')
            },
          }
        )
      }
    },
    changeTab (key) {
      this.defaultActiveKey = key
    },
    fntabClick (it) {
      console.log('fntabClick', it)
      // this.defaultActiveKey = it
      this.$refs.taTabsDom.activeKey = it
    },
    showDrawer (prevViewItem) {
      this.prevViewItem = prevViewItem
      this.visible = true
      this.hasUpdate = false
      this.getDictData()
      this.$nextTick(() => {
        console.log('this.$refs.taTabsDom==', this.$refs.taTabsDom)
        this.$refs.taTabsDom.activeKey = '1'
      })
      this.getInstitution()
      if (prevViewItem) {
        // 基本信息
        this.hasUpdate = true
        this.queryDetail(prevViewItem.id)
      } else {
        let propertysTrue = []
        let propertysFalse = []
        if (this.projectQuality == '01') {
          propertysTrue.push('funder')
          propertysFalse.push('publicFundraising', 'recordCode', 'recordName')
        } else if (this.projectQuality == '02') {
          propertysFalse.push(
            'funder',
            'publicFundraising',
            'recordCode',
            'recordName'
          )
        } else if (this.projectQuality == '03') {
          propertysFalse.push('funder')
          propertysTrue.push('publicFundraising')
          propertysFalse.push('recordCode', 'recordName')
        }
        if (propertysTrue.length > 0) {
          hlta_SetCompsRadioGroup_muliPropertys.call(
            this,
            this.createItems2,
            propertysTrue,
            {
              hidden: () => {
                return true
              },
            }
          )
        }
        if (propertysFalse.length > 0) {
          hlta_SetCompsRadioGroup_muliPropertys.call(
            this,
            this.createItems2,
            propertysFalse,
            {
              hidden: () => {
                return false
              },
            }
          )
        }
      }
    },
    fnTreeSelectChange (value, label, extra) {
      console.log('value, label, extra=', value, label, extra)
      // this.searchParams.bkap1002 = `${value}`;
    },
    save () {
      if (this.hasUpdate) {
        this.update(this.prevViewItem.id)
      } else {
        this.add()
      }
    },
    add () {

      let form1 = this.$refs['t-form01'].form999
      let form2 = this.$refs['t-form02'].form999
      let startTime = form1.getFieldMomentValue('projectStartTime')
      let endTime = form1.getFieldMomentValue('projectEndTime')
      if (startTime > endTime) {
        this.$message.error('结束时间应当大于等于开始时间')
        return
      }
      if (this.item.cpServeObjectPoList === []) {
        this.$message.error('服务对象不能为空')
        return
      }
      this.$refs['t-form01'].form999.setFieldsValue({ 'cpServeObjectPoList': this.item.cpServeObjectPoList })
      let formData1 = form1.getFieldsValue()
      formData1.projectStartTime =
        form1.getFieldMomentValue('projectStartTime')
      formData1.projectEndTime = form1.getFieldMomentValue('projectEndTime')
      formData1.cpServeObjectPoList = this.item.cpServeObjectPoList
      let formData2 = form2.getFieldsValue()
      let validateFlag = true
      this.$refs['t-form01'].form999.validateFields((err, values) => {
        console.log('errr=====', err)
        console.log('values====', values)
        if (err) {
          validateFlag = false
        }
      })
      this.$refs['t-form02'].form999.validateFields((err, values) => {
        if (err) {
          validateFlag = false
        }
      })
      for (let i = 0; i < this.tform_group.length; i++) {
        let [tGroupItem] = this.$refs[`t-form${i}`]
        tGroupItem.form999.validateFields((err, values) => {
          if (err) {
            validateFlag = false
          }
        })
      }
      if (validateFlag) {
        if (this.fileList.length > 0) {
          let list = []
          this.fileList.forEach((item) => {
            if (!item.response) {
              console.log("sjkdb jksd9999 ")
            } else {
              list.push(item.response.data.result.ossId)
            }
          })
          formData2.ossIdList = list
        } else {
          formData2.ossIdList = null
        }
        if (this.fileList2.length > 0) {
          let list = []
          this.fileList2.forEach((item) => {
            if (!item.response) {
              console.log("sjkdb jksd ")

            } else {
              list.push(item.response.data.result.ossId)
            }
          })
          formData2.assReportList = list
        } else {
          formData2.assReportList = null
        }
        let param = { ...formData1, ...formData2 }
        let projectExecutingPartyList = []
        for (let i = 0; i < this.tform_group.length; i++) {
          let [tGroupItem] = this.$refs[`t-form${i}`]
          projectExecutingPartyList.push(tGroupItem.form999.getFieldsValue())
        }
        const orgId = []
        let f = true
        projectExecutingPartyList.map((item) => {
          if (orgId.indexOf(item.bsoId) !== -1) {
            f = false
          } else {
            orgId.push(item.bsoId)
          }
        })
        if (!f) {
          this.$message.error('一个项目不能选择相同的执行机构')
          return
        }
        param.projectExecutingPartyList = projectExecutingPartyList
        this.Base.submit(
          null,
          {
            url: 'collaborateProject/add',
            data: param,
            method: 'post',
            // autoValid: true, // 提交前自动验证
            autoQs: false,
          }
          // {
          //   successCallback: (data) => {
          //     this.$message.success("新增成功!");
          //     this.onClose();
          //   },
          //   failCallback: (data) => {
          //     this.$message.error("新增失败!{}", data);
          //   },
          // }
        ).then(res => {
          this.$message.success('新增成功！')
          this.onClose()
          console.log('res=====', res)
        }).catch(err => {
          this.$hltaSuperUT.forceUninstalledTaMsgComp(3000)
          this.$message.error('新增失败！')
          console.log('err===', err)
        })
      }
    },
    update (id) {
      let form1 = this.$refs['t-form01'].form999
      let form2 = this.$refs['t-form02'].form999
      let startTime = form1.getFieldMomentValue('projectStartTime')
      let endTime = form1.getFieldMomentValue('projectEndTime')
      if (startTime > endTime) {
        this.$message.error('结束时间应当大于等于开始时间')
        return
      }
      if (this.item.cpServeObjectPoList === []) {
        this.$message.error('服务对象不能为空')
        return
      }
      let formData1 = form1.getFieldsValue()
      formData1.projectStartTime =
        form1.getFieldMomentValue('projectStartTime')
      formData1.projectEndTime = form1.getFieldMomentValue('projectEndTime')
      formData1.cpServeObjectPoList = this.item.cpServeObjectPoList
      let formData2 = form2.getFieldsValue()
      let validateFlag = true
      this.$refs['t-form01'].form999.validateFields((err, values) => {
        if (err) {
          validateFlag = false
        }
      })
      this.$refs['t-form02'].form999.validateFields((err, values) => {
        if (err) {
          validateFlag = false
        }
      })
      for (let i = 0; i < this.tform_group.length; i++) {
        let [tGroupItem] = this.$refs[`t-form${i}`]
        tGroupItem.form999.validateFields((err, values) => {
          if (err) {
            validateFlag = false
          }
        })
      }
      if (validateFlag) {
        let pamram = {}
        if (this.fileList.length > 0) {
          let list = []
          this.fileList.forEach((item) => {
            console.log("item---",item)
            if (!item.response) {
              list.push(item.uid)
            } else {
              list.push(item.response.data.result.ossId)
            }
          })
          formData2.ossIdList = list
        } else {
          formData2.ossIdList = null
        }
        if (this.fileList2.length > 0) {
          let list = []
          this.fileList2.forEach((item) => {
            if (!item.response) {
              list.push(item.uid)
            } else {
              list.push(item.response.data.result.ossId)
            }
          })
          formData2.assReportList = list
        } else {
          formData2.assReportList = null
        }
        Object.assign(pamram, formData1, formData2)
        let projectExecutingPartyList = []
        for (let i = 0; i < this.tform_group.length; i++) {
          let [tGroupItem] = this.$refs[`t-form${i}`]
          projectExecutingPartyList.push(tGroupItem.form999.getFieldsValue())
        }
        const orgId = []
        let f = true
        projectExecutingPartyList.map((item) => {
          if (orgId.indexOf(item.bsoId) !== -1) {
            f = false
          } else {
            orgId.push(item.bsoId)
          }
        })
        if (!f) {
          this.$message.error('一个项目不能选择相同的执行机构')
          return
        }
        pamram.projectExecutingPartyList = projectExecutingPartyList
        this.Base.submit(
          null,
          {
            url: 'collaborateProject/update',
            data: pamram,
            method: 'post',
            // autoValid: true, // 提交前自动验证
            autoQs: false,
            params: { id: id },
          }
          // {
          //   successCallback: (data) => {
          //     this.$message.success("修改成功!");
          //     this.onClose();
          //   },
          //   failCallback: (data) => {
          //     this.$message.error("修改失败!");
          //   },
          // }
        ).then(res => {
          this.$message.success('修改成功！')
          this.onClose()
          console.log('res=====', res)
        }).catch(err => {
          this.$hltaSuperUT.forceUninstalledTaMsgComp(3000)
          this.$message.error('修改失败！')
          console.log('err===', err)
        })
      }
    },
    onClose () {
      this.$refs['t-form01'].form999.resetFields()
      this.$refs['t-form02'].form999.resetFields()
      for (let i = 0; i < this.tform_group.length; i++) {
        let [tGroupItem] = this.$refs[`t-form${i}`]
        tGroupItem.form999.resetFields()
      }
      this.$parent.$parent.doQuery()
      this.defaultActiveKey = '1'
      this.visible = false
      this.fileList = []
      this.fileList2 = []
      this.institutionList = []
      this.prevViewItem = null
      this.detailInfo = null
      this.resetForm()
      this.resetItems()
      this.item = {}
      this.item2 = {}
    },
    resetForm () {
      this.$refs['t-form01'].form999.resetFields()
      this.$refs['t-form02'].form999.resetFields()
    },
    //重置表单显示隐藏属性
    resetItems () {
      hlta_SetCompsSelectTreeData.call(
        this,
        this.createItems,
        'admsAreaList',
        [],
        []
      )
      hlta_SetCompsRadioGroup_muliPropertys.call(
        this,
        this.createItems2,
        ['publicFundraising', 'recordCode', 'recordName'],
        {
          hidden: () => {
            return false
          },
        }
      )
    },
    async queryDetail (id) {
      // await this.getInstitution()

      let param = {}
      param.id = id
      this.Base.submit(null, {
        method: 'post',
        url: 'collaborateProject/detail',
        data: param,
      }).then((data) => {
        let detailInfo = data.data.result
        this.detailInfo = data.data.result
        // this.handleBranch(this.detailInfo.cpTypePoList, this.cpTypeTreeData, true)
        hlta_SetCompsCheckGroup_onValues.call(
          this,
          this.createItems,
          'cpServeObjectPoList',
          detailInfo.cpServeObjectPoList
        )
        this.$set(
          this.item,
          'cpServeObjectPoList',
          detailInfo.cpServeObjectPoList
        )
        console.log(
          'this.createItems==详情',
          this.createItems,
          'item',
          this.item
        )
        hlta_SetCustomComps_general_initOptdata.call(
          this,
          this.createItems2,
          'cpTypePoList',
          detailInfo.cpTypePoList,
          'treeDefaultExpandedKeys'
        )
        //获取区划数据
        this.Base.submit(null, {
          method: 'post',
          url: 'area/selectEcho',
          data: { selectedPaths: detailInfo.admsAreaListCodePath },
          autoQs: false,
        }).then((res) => {
          hlta_SetCompsSelectTreeData.call(
            this,
            this.createItems,
            'admsAreaList',
            res.data.result,
            detailInfo.admsAreaList
          )

          if (this.detailInfo.ossIdList) {
            let fileList = []
            this.detailInfo.ossIdList.forEach((item) => {
              let f = {}
              f.name = item.originalName
              f.url = item.path
              f.uid = item.ossId
              f.status = 'done'
              fileList.push(f)
            })
            this.fileList = fileList
          }
          if (this.detailInfo.assReportList) {
            let fileList = []
            this.detailInfo.assReportList.forEach((item) => {
              let f = {}
              f.name = item.originalName
              f.url = item.path
              f.uid = item.ossId
              f.status = 'done'
              fileList.push(f)
            })
            this.fileList2 = fileList
          }
          let propertysTrue = []
          let propertysFalse = []
          if (this.detailInfo.projectQuality == '01') {
            propertysTrue.push('funder')
            propertysFalse.push(
              'publicFundraising',
              'recordCode',
              'recordName'
            )
          } else if (this.detailInfo.projectQuality == '02') {
            propertysFalse.push(
              'funder',
              'publicFundraising',
              'recordCode',
              'recordName'
            )
          } else if (this.detailInfo.projectQuality == '03') {
            propertysFalse.push('funder')
            propertysTrue.push('publicFundraising')
            if (this.detailInfo.publicFundraising == '1') {
              propertysTrue.push('recordCode', 'recordName')
            } else {
              propertysFalse.push('recordCode', 'recordName')
            }
          }
          if (propertysTrue.length > 0) {
            hlta_SetCompsRadioGroup_muliPropertys.call(
              this,
              this.createItems2,
              propertysTrue,
              {
                hidden: () => {
                  return true
                },
              }
            )
          }
          if (propertysFalse.length > 0) {
            hlta_SetCompsRadioGroup_muliPropertys.call(
              this,
              this.createItems2,
              propertysFalse,
              {
                hidden: () => {
                  return false
                },
              }
            )
          }

          // this.$refs['t-form02'].form999.setFieldsValue({riskMeasure: this.detailInfo.riskMeasure})
          this.$refs['t-form01'].initFormAllIt(this.detailInfo)
          this.$refs['t-form02'].initFormAllIt(this.detailInfo)
          let projectExecutingPartyList =
            this.detailInfo.projectExecutingPartyList
          if (projectExecutingPartyList.length > 0) {
            this.tform_group = []
            for (let i = 0; i < projectExecutingPartyList.length; i++) {
              this.tform_group.push({
                item: {},
                createItems: this.createItems3,
              })
            }
          } else {
            this.tform_group = [
              {
                item: {},
                createItems: this.createItems3,
              },
            ]
          }

          this.$nextTick(() => {
            this.$refs['t-form01'].initFormAllIt(detailInfo)
            this.$refs['t-form02'].initFormAllIt(detailInfo)
            for (let i = 0; i < this.tform_group.length; i++) {
              console.log('i=======吹時候', i)
              let [tformBlock] = this.$refs[`t-form${i}`]
              // let [tGroupItem] = this.$refs[`t-form${i}`];
              // console.log("tGroupItem====", tGroupItem);
              tformBlock.initFormAllIt(projectExecutingPartyList[i])
            }
          })
        })
      })
    },
    deactivated () {
      this.$destroy()
    },
  },
}
</script>
```
